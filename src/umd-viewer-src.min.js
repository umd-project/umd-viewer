import Umd from"./Umd.min.js";import{UmdComponentMd}from"./components/md/umd-component-md.min.js";import{UmdComponentPdf}from"./components/pdf/umd-component-pdf.min.js";import{UmdComponentImage}from"./components/image/umd-component-image.min.js";import{UmdComponentAudio}from"./components/audio/umd-component-audio.min.js";import{UmdComponentVideo}from"./components/video/umd-component-video.min.js";import{UmdComponentText}from"./components/text/umd-component-text.min.js";import{UmdComponentForm}from"./components/form/umd-component-form.min.js";const template=document.createElement("template");template.innerHTML='\n    <style>\n    :host {\n        width: 100%;\n        height:100%;\n        max-width: 600px;\n        display: grid;\n        grid-template-rows: auto !important;\n        grid-template-columns: auto !important;\n        font-family: sans-serif;\n    }\n\n    :host([hidden]), [hidden] {\n        display: none !important;\n    }\n    \n    .password-container {\n        grid-row: 1;\n        display: grid;\n        grid-template-rows: repeat(2, max-content);\n        grid-template-columns: max-content;\n        grid-row-gap: 16px;\n        align-content: center;\n        justify-content: center;\n    }\n\n    .message {\n        font-size: 14px;\n        text-align: center;\n    }\n\n    .input {\n        font-size: 14px;\n        height: 32px;\n        line-height: 32px;\n        justify-self: center;\n        text-align: center;\n        outline: none;\n    }\n\n    ::placeholder {\n        font-size: 12px;\n    }\n\n    input:focus {\n        outline: none;\n        border: none;\n    }\n\n    .input-error {\n        border: solid 0.5px #ff0000;\n    }\n\n    .content {\n        grid-row: 1;\n        display: grid;\n        grid-auto-rows: max-content;\n        grid-template-columns: auto;\n        grid-row-gap: 16px;\n    }\n\n    </style>\n    <div class="password-container" hidden>\n        <div class="message">Enter this document"s password</div>\n        <input class="input" size="20" type="password" placeholder="passwords are case sensitive">\n    </div>\n    <div class="content" hidden>\n    </div>\n';export class UmdViewer extends HTMLElement{static get observedAttributes(){return[]}constructor(){super(),this._shadowRoot=this.attachShadow({mode:"closed"}),this._shadowRoot.appendChild(template.content.cloneNode(!0)),this._file=null,this._url="",this._password="",this._loaded=!1,this._beingLoaded=!1,this._umd=new Umd,this._shadowRoot.querySelector(".input").addEventListener("blur",this._checkPassword.bind(this)),this._shadowRoot.querySelector(".input").addEventListener("keyup",this._checkKeyup.bind(this))}connectedCallback(){}attributeChangedCallback(name,oldVal,newVal){switch(name){case"data-src":newVal&&this._openUrl(newVal)}}get file(){return this._file}set file(obj){this._file=obj,this._loaded=!1,this._loadFile()}get url(){return this._url}set url(url){this._url=url,this._openUrl()}get password(){return this._password}set password(p){this._password=p,this._file&&this._loadFile()}_openUrl(){if(!this._url)return;let _filename="untitled";this._loaded=!1,this._beingLoaded=!1;const _f=this._url.split("/").pop();_f&&(_filename=_f),fetch(this._url).then(response=>{if(response.status>=200&&response.status<=299)return response.blob();throw Error(response.statusText)}).then(blob=>{const _file=new File([blob],_filename,{type:blob.type});this._file=_file,this._loadFile()}).catch(err=>{console.log(err)})}_loadFile(){if(!this._file)return;if(this._loaded)return;if(this._beingLoaded)return;this._beingLoaded=!0;const _contentele=this._shadowRoot.querySelector(".content"),_passwordele=this._shadowRoot.querySelector(".password-container");_contentele.innerHTML="",_contentele.setAttribute("hidden",""),_passwordele.setAttribute("hidden",""),this._umd.openFile(this._file,this._password).then(_res=>{this._beingLoaded=!1,this._loaded=!0,this._umd.elements.forEach(ele=>{_contentele.appendChild(ele)}),_contentele.removeAttribute("hidden")}).catch(_err=>{this._beingLoaded=!1,this._shadowRoot.querySelector(".password-container").removeAttribute("hidden"),this._shadowRoot.querySelector(".input").focus(),""!=this._shadowRoot.querySelector(".input").value&&this._shadowRoot.querySelector(".input").classList.add("input-error")})}_checkPassword(e){this._shadowRoot.querySelector(".input").classList.remove("input-error");const _p=this._shadowRoot.querySelector(".input").value;_p&&this._password!=_p&&(this._password=_p,this._loadFile())}_checkKeyup(e){"Enter"==e.key&&this._checkPassword(e)}disconnectedCallback(){}}window.customElements.define("umd-viewer",UmdViewer);